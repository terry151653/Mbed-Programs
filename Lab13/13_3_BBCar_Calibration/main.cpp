#include "mbed.h"
#include "bbcar.h"

Ticker servo_ticker;
PwmOut pin5(D12), pin6(D13);

BBCar car(pin5, pin6, servo_ticker);

int main()
{
   // please contruct you own calibration table with each servo
   double pwm_table0[] = {-120, -115, -110, -105, -100, -95, -90, -85, -80, -75, -70, -65, -60, -55, -50, -45, -40,
   -35, -30, -25, -20, -15, -10, -5, 0, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55, 60, 65, 70, 75, 80, 85, 90, 95, 100,
   105, 110, 115, 120};
   double speed_table0[] = {-16.371, -16.158, -16.158, -15.945, -15.733, -15.520, -15.095, -14.883, -14.457, -14.032,
   -13.607, -12.756, -12.119, -11.056, -10.418, -9.142, -8.291, -7.229, -6.165, -4.890, -3.827, -2.764, -1.488, -0.425,
   0.000, 0.425, 1.488, 2.764, 3.827, 4.890, 6.165, 7.229, 8.291, 9.142, 10.418, 11.056, 12.119, 12.756, 13.607, 14.032,
   14.457, 14.883, 15.095, 15.520, 15.733, 15.945, 16.158, 16.158, 16.371};

   double pwm_table1[] = {-120, -115, -110, -105, -100, -95, -90, -85, -80, -75, -70, -65, -60, -55, -50, -45, -40,
   -35, -30, -25, -20, -15, -10, -5, 0, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55, 60, 65, 70, 75, 80, 85, 90, 95, 100,
   105, 110, 115, 120};
   double speed_table1[] = {-16.371, -16.158, -16.158, -15.946, -15.520, -15.307, -15.095, -14.670, -14.245, -13.607,
   -13.181, -12.544, -11.693, -11.055, -9.780, -9.142, -7.866, -7.016, -6.165, -4.890, -3.614, -2.976, -1.488, -0.425,
   0.000, 0.425, 1.488, 2.976, 3.614, 4.890, 6.165, 7.016, 7.866, 9.142, 9.780, 11.055, 11.693, 12.544, 13.181, 13.607,
   14.245, 14.670, 15.095, 15.307, 15.520, 15.946, 16.158, 16.158, 16.371};

   // first and fourth argument : length of table
   car.setCalibTable(49, pwm_table0, speed_table0, 49, pwm_table1, speed_table1);

   while (1)
   {
      car.goStraightCalib(5);
      ThisThread::sleep_for(5s);
      car.stop();
      ThisThread::sleep_for(5s);
   }
}